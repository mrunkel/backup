#!/bin/sh

## THIS FILE IS GENERATED BY ut_backup in puppet.
## Changes will be replaced.

# verify that our bucket exists, if not, make it.
if [ `s3cmd ls | grep -c <%= @bucket %>$` -eq 0 ]; then
    s3cmd mb <%= @bucket %>
fi

<% @directories.each do |dir| -%>
<%   if @dir =~ /\/$/ then -%>
<%= "s3cmd sync #{dir} s3://#{bucket}/#{hostname}#{dir}" %>
<%   else -%>
<%= "s3cmd sync #{dir}/ s3://#{bucket}/#{hostname}#{dir}/" %>
<%   end -%>
<% end -%>

<% @files.each do |file| -%>
<%= "s3cmd cp #{file} s3://#{bucket}/#{hostname}#{file}" %>
<% end -%>
